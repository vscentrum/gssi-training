Bootstrap: docker
From: ubuntu:24.04

%arguments
    conda_base=/opt/conda
    conda_installer=Miniforge3-Linux-x86_64.sh

%environment
export PATH="{{ conda_base }}/bin:$PATH"

%post
apt update && apt upgrade -y
apt install -y wget

wget https://github.com/conda-forge/miniforge/releases/latest/download/{{ conda_installer }}

bash {{ conda_installer }} -b -p {{ conda_base }}

# Remove the installer
rm {{ conda_installer }}

export PATH="{{ conda_base }}/bin:$PATH"

conda create -n tblite -c conda-forge tblite-python -y

# Clean up the Conda cache to minimize container size
conda clean --all -y

# Clean up apt cache and unnecessary packages
apt-get clean
rm -rf /var/lib/apt/lists/*

%runscript
#!/bin/bash
source {{ conda_base }}/etc/profile.d/conda.sh
conda activate tblite
exec "$@"

%help
This container holds a minimal conda environment with 'tblite-python', installed on an Ubuntu 24.04 base.
Usage:
$ apptainer run <image> tblite --version
$ apptainer run <image> python -c 'import tblite'

